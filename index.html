<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mahfil-e-Motijheel | Royal Room Service</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'silver-mist': '#f8fafc',
                        'silver-plate': '#e2e8f0',
                        'silver-metal': '#94a3b8',
                        'royal-blue': '#1e3a8a',
                        'royal-blue-light': '#3b82f6',
                        'garden-green': '#22c55e',
                        'garden-green-dark': '#15803d',
                        'garden-green-pale': '#dcfce7',
                    },
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    animation: { 'blob': 'blob 10s infinite', 'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards' },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        slideUp: { from: { opacity: 0, transform: 'translateY(20px)' }, to: { opacity: 1, transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        html, body { height: 100dvh; width: 100vw; overflow: hidden; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        
        #app { height: 100dvh; width: 100vw; overflow: hidden; padding: 0; margin: 0; }
        #main-content { height: 100%; width: 100%; display: flex; flex-direction: column; overflow: hidden; background: #f8fafc; }
        
        .glass-panel { 
            background: rgba(255, 255, 255, 0.85); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(148, 163, 184, 0.4); 
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); 
        }
        
        .primary-button { 
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); 
            color: white; 
            box-shadow: 0 8px 20px -4px rgba(34, 197, 94, 0.4); 
            border: 1px solid #15803d; 
        }
        
        .glass-header { 
            background: linear-gradient(to bottom, #f8fafc 0%, rgba(248, 250, 252, 0.9) 100%);
            backdrop-filter: blur(10px); 
            border-bottom: 1px solid #e2e8f0; 
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; border: 1px solid #fff; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .fixed-bottom-center { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); width: calc(100% - 32px); max-width: 450px; z-index: 50; }
        button:focus-visible, a:focus-visible, input:focus-visible { outline: 2px solid #22c55e; outline-offset: 2px; }
        
        /* Loading Spinner for buttons */
        .btn-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="app" class="flex items-center justify-center">
        <div id="main-content" class="relative">
            <div id="loading-screen" class="absolute inset-0 z-50 flex items-center justify-center bg-silver-mist">
                <div class="flex flex-col items-center gap-6">
                    <div class="relative">
                        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-royal-blue border-l-transparent border-r-transparent"></div>
                    </div>
                    <p class="text-sm text-royal-blue font-extrabold tracking-[0.3em] uppercase animate-pulse">Mahfil-e-Motijheel</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp, arrayUnion } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = JSON.parse('{"apiKey": "AIzaSyCKOP0tIdVjPi6pMvGhKh2qAIpNkbC10qk", "authDomain": "room-service-f8e98.firebaseapp.com", "projectId": "room-service-f8e98", "storageBucket": "room-service-f8e98.firebasestorage.app", "messagingSenderId": "275656823640", "appId": "1:275656823640:web:ee6350819f0ca233298b2d"}');
        const appId = "room-service-f8e98";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- ACCOUNT MANAGEMENT ---
        // Add new accounts here. 
        // roles: 'admin' (Can Delete/Edit), 'manager' (Can Edit), 'staff' (View/Kitchen)
        const AUTHORIZED_USERS = [
            { id: 'admin',      role: 'admin' },
            { id: 'manager',    role: 'manager' },
            { id: 'sudip',      role: 'manager' },
            { id: 'gm',         role: 'manager' },
            { id: 'chef',       role: 'manager' },
            { id: 'zahida',     role: 'admin' },
            { id: 'liaquat',    role: 'admin' },
            { id: 'yusuf',      role: 'admin' },
            { id: 'saukat',     role: 'admin' },
            { id: 'mohammed',   role: 'admin' },
            { id: 'it',         role: 'admin' },
            { id: 'rehan',      role: 'admin' }
        ];

        const VARIANT_MAPS = {
            'C': ['Veg', 'Chicken', 'Mixed'],
            'D': ['Broiler', 'Desi'],
            'L': ['Small', 'Large'],
            'M': ['Masala', 'Cheese'],
            'K': ['Makhani', 'Kadhai', 'Lababdar', 'Palak'],
            'MT': ['Kosha', 'Rogan Josh', 'Do Pyaza'],
            'S': ['Penne', 'Spaghetti'],
            'I': ['Butterscotch', 'Vanilla', 'Chocolate', 'Nolen Gur'],
            'Z': ['Chilli', 'Schezwan', 'Manchurian', 'Sweet & Sour'],
            'P': ['Chilli', 'Schezwan', 'Manchurian', 'Sweet & Sour', 'Black Pepper'],
            'A': ['Veg', 'Non-Veg'],
            'B': ['Tandoor', 'Naan', 'Kulcha']
        };

        const MENU_DATA = [
            // SOUP
            { id: 1, name: "Tomato & Basil Soup", price: 129, cat: "Soup", desc: "Healthy soup of fresh tomatoes flavoured with basil" },
            { id: 2, name: "Choice of Cream Soup", prices: [129, 149], type: 'A', cat: "Soup", desc: "Authentic creamy soup, smooth and comforting" },
            { id: 3, name: "Carrot Almond Soup", prices: [129, 149], type: 'A', cat: "Soup", desc: "Vegan soup of blanched carrots and almonds, garlic & pepper" },
            { id: 4, name: "Manchow Soup", prices: [129, 149], type: 'A', cat: "Soup", desc: "Thick soy and chilli-based soup with crunchy noodles" },
            { id: 5, name: "Lemon Coriander Soup", prices: [129, 149], type: 'A', cat: "Soup", desc: "Light, healthy clear soup flavoured with coriander" },
            { id: 6, name: "Tom Yum Soup", prices: [129, 149], type: 'A', cat: "Soup", desc: "Popular Thai soup with bold hot and sour flavours" },
            // SALAD
            { id: 7, name: "Green Salad", price: 99, cat: "Salad", desc: "Fresh seasonal vegetables, light and refreshing" },
            { id: 8, name: "Caesar Salad", prices: [169, 199], type: 'A', cat: "Salad", desc: "Iceberg lettuce in Caesar dressing with parmesan & croutons" },
            { id: 9, name: "Waldorf Salad", prices: [199, 239], type: 'A', cat: "Salad", desc: "Apples, celery and walnuts dressed in creamy mayonnaise" },
            { id: 10, name: "Greek Salad", prices: [189, 229], type: 'A', cat: "Salad", desc: "Cucumbers, tomatoes, olives and feta in olive oil dressing" },
            { id: 11, name: "Chicken Tikka Smoked Salad", price: 229, cat: "Salad", desc: "Smoked chicken tikka with tomato, onion, bell pepper" },
            // SMALL BITE
            { id: 12, name: "Cheese Chickpeas Finger", price: 159, cat: "Small Bite", desc: "Mashed chickpeas and cheese with herbs, crumb fried" },
            { id: 13, name: "French Fries", price: 139, cat: "Small Bite", desc: "Classic crispy potato fries" },
            { id: 14, name: "Nachos with Salsa", price: 169, cat: "Small Bite", desc: "Tortilla chips with jalapeno, melted cheese and salsa" },
            { id: 15, name: "Pakoda", price: 129, cat: "Small Bite", desc: "Mixed vegetable, onion or potato fritters" },
            { id: 16, name: "Kolkata Fish Fry", price: 199, cat: "Small Bite", desc: "Crumb-fried desi bhetki with lime, garlic and mustard" },
            { id: 17, name: "Fish Finger", price: 189, cat: "Small Bite", desc: "Crumb-fried desi bhetki fingers, crisp and golden" },
            { id: 18, name: "Nawabi Devil", prices: [169, 189], type: 'A', cat: "Small Bite", desc: "Spiced chicken or mutton cutlets, Kolkata style" },
            { id: 19, name: "Chicken Pakoda", price: 169, cat: "Small Bite", desc: "All-time favourite crispy chicken fritters" },
            // APPETIZERS
            { id: 20, name: "Ambi Paneer Tikka", price: 249, cat: "Appetizers", desc: "Stuffed and grilled cottage cheese cubes" },
            { id: 21, name: "Koraishuti Tikka", price: 229, cat: "Appetizers", desc: "Spiced green pea galette, grilled" },
            { id: 22, name: "Malai Broccoli", price: 249, cat: "Appetizers", desc: "Broccoli florets marinated in cheesy cream and roasted" },
            { id: 23, name: "Nawabi Moti Murgh Kebab", price: 289, cat: "Appetizers", desc: "Juicy chicken kebabs, rich and royal" },
            { id: 24, name: "Siraji Galouti Kebab", price: 349, cat: "Appetizers", desc: "Soft melt-in-mouth kebabs, Nawabi style" },
            { id: 25, name: "Murgh Shahi Bhatina", price: 289, cat: "Appetizers", desc: "Special spiced chicken preparation" },
            { id: 26, name: "Bhatti Ka Murgh Tikka", price: 279, cat: "Appetizers", desc: "Boneless chicken marinated in spiced yogurt, clay oven cooked" },
            { id: 27, name: "Gandharaj Murgh Tikka", price: 349, cat: "Appetizers", desc: "Chicken tikka with kaffir lime and spiced yogurt" },
            { id: 28, name: "Fish Mahi Tikka", price: 449, cat: "Appetizers", desc: "Desi bhetki fillet marinated and grilled" },
            { id: 29, name: "Prawn Lasooni Tikka", price: 479, cat: "Appetizers", desc: "Garlic-marinated tiger prawns grilled in clay oven" },
            { id: 30, name: "Tandoori Arabian Pomfret", price: 499, cat: "Appetizers", desc: "Whole pomfret marinated and tandoor grilled" },
            // INDO-CHINESE APPETIZERS
            { id: 31, name: "Crispy Chilli Baby Corn", price: 229, cat: "Indo-Chinese", desc: "Crunchy baby corn tossed in chilli sauce" },
            { id: 32, name: "Paneer 65", price: 249, cat: "Indo-Chinese", desc: "Crispy paneer tossed in bold Indian spices" },
            { id: 33, name: "Soya Chilli Paneer", price: 239, cat: "Indo-Chinese", desc: "Paneer tossed in Chinese-style chilli sauce" },
            { id: 34, name: "Wood Fire Chicken Chilli", price: 269, cat: "Indo-Chinese", desc: "Boneless chicken tossed in soy chilli sauce" },
            { id: 35, name: "Hunan Chicken", price: 279, cat: "Indo-Chinese", desc: "Chicken and vegetables in spicy Hunan sauce" },
            { id: 36, name: "Tai Pai Kai", price: 279, cat: "Indo-Chinese", desc: "Crispy fried chicken tossed in Thai curry paste" },
            { id: 37, name: "Thai Basil Chicken", price: 289, cat: "Indo-Chinese", desc: "Chicken tossed with Thai chilli basil sauce" },
            { id: 38, name: "Bamboo Cashew Nut Chicken", price: 299, cat: "Indo-Chinese", desc: "Chicken with bamboo shoots and cashews in Schezwan sauce" },
            { id: 39, name: "Sweet & Spicy Crispy Chicken", price: 289, cat: "Indo-Chinese", desc: "Crispy chicken in tangy sweet-spicy glaze" },
            { id: 40, name: "Teriyaki Chicken", price: 289, cat: "Indo-Chinese", desc: "Chicken glazed with sweet savoury teriyaki sauce" },
            { id: 41, name: "Chicken 65", price: 279, cat: "Indo-Chinese", desc: "Crispy fried chicken with bold spices" },
            { id: 42, name: "Roasted Chicken in Chilli Plum Sauce", price: 299, cat: "Indo-Chinese", desc: "Charred chicken in sweet and tangy plum chilli glaze" },
            { id: 43, name: "Pan Fried Chilli Fish", price: 349, cat: "Indo-Chinese", desc: "Fish fillets pan-seared and tossed in spicy chilli sauce" },
            { id: 44, name: "Fish in Tangy Mustard", price: 369, cat: "Indo-Chinese", desc: "Bengali-style fish in sharp mustard sauce" },
            { id: 45, name: "Prawn Chilli Basil Dry", price: 479, cat: "Indo-Chinese", desc: "Crispy prawns tossed in chilli basil sauce" },
            // SIDES
            { id: 46, name: "Choice of Raita", price: 129, cat: "Sides", desc: "Mixed vegetable, pineapple or boondi" },
            { id: 47, name: "Plain Curd", price: 69, cat: "Sides", desc: "Fresh homemade yogurt" },
            { id: 48, name: "Papad", price: 79, cat: "Sides", desc: "Masala, fried or roasted" },
            { id: 49, name: "Masala Peanut", price: 149, cat: "Sides", desc: "Roasted peanuts tossed with spices" },
            { id: 50, name: "Fried Cashewnuts", price: 249, cat: "Sides", desc: "Lightly roasted cashews" },
            // INDIAN
            { id: 51, name: "Dal Tadka", price: 149, cat: "Indian" },
            { id: 52, name: "Dal Makhani", price: 179, cat: "Indian" },
            { id: 53, name: "Yellow Dal Fry", price: 129, cat: "Indian" },
            { id: 54, name: "Paneer", prices: [249, 249, 249, 249], type: 'K', cat: "Indian", desc: "Choice of Preparation" },
            { id: 55, name: "Tawa Veg", price: 229, cat: "Indian" },
            { id: 56, name: "Aloo Do Pyaza", price: 199, cat: "Indian" },
            { id: 57, name: "Butter Chicken", price: 289, cat: "Indian" },
            { id: 58, name: "Chicken Bharta", price: 279, cat: "Indian" },
            { id: 59, name: "Chicken Do Pyaza", price: 289, cat: "Indian" },
            { id: 60, name: "Mutton", prices: [479, 479, 479], type: 'MT', cat: "Indian", desc: "Choice of Preparation" },
            { id: 61, name: "Prawn Butter Masala", price: 479, cat: "Indian" },
            // RICE & ROTI
            { id: 62, name: "Tandoor Roti", prices: [49, 59], type: 'B', cat: "Rice & Roti" },
            { id: 63, name: "Naan", prices: [59, 69], type: 'L', cat: "Rice & Roti" },
            { id: 64, name: "Stuffed Kulcha", prices: [99], type: 'M', cat: "Rice & Roti" },
            { id: 65, name: "Lachha Paratha", price: 59, cat: "Rice & Roti" },
            { id: 66, name: "Steamed Rice", price: 99, cat: "Rice & Roti" },
            { id: 67, name: "Veg Pulao", price: 169, cat: "Rice & Roti" },
            { id: 68, name: "Basanti Pulao", price: 179, cat: "Rice & Roti" },
            { id: 69, name: "Bengali Kaju Kishmish Pulao", price: 179, cat: "Rice & Roti" },
            { id: 70, name: "Jeera Rice", price: 149, cat: "Rice & Roti" },
            { id: 71, name: "Dum Biryani", prices: [149, 249], type: 'A', cat: "Rice & Roti" },
            { id: 72, name: "Spl Biryani", prices: [249, 399], type: 'A', cat: "Rice & Roti" },
            { id: 73, name: "Sizzler Biryani", prices: [249, 399], type: 'A', cat: "Rice & Roti" },
            // BENGAL
            { id: 74, name: "Narkel Diya Postor Bora", price: 259, cat: "Bengal" },
            { id: 75, name: "Jhuri Aloo Bhaja", price: 99, cat: "Bengal" },
            { id: 76, name: "Begun Bhaja", price: 99, cat: "Bengal" },
            { id: 77, name: "Aloo Posto", price: 179, cat: "Bengal" },
            { id: 78, name: "Phulkopir Roast", price: 179, cat: "Bengal" },
            { id: 79, name: "Channar Dalna", price: 239, cat: "Bengal" },
            { id: 80, name: "Plain Masoor Dal", price: 99, cat: "Bengal" },
            { id: 81, name: "Bhaja Moong Dal", price: 129, cat: "Bengal" },
            { id: 82, name: "Macher Matha Diye Moong Dal", price: 149, cat: "Bengal" },
            { id: 83, name: "Kacha Lanka Dhonepata Murgi", prices: [279, 379], type: 'D', cat: "Bengal" },
            { id: 84, name: "Daab Murgi", prices: [289, 399], type: 'D', cat: "Bengal" },
            { id: 85, name: "Kosha Murgi", prices: [249, 379], type: 'D', cat: "Bengal" },
            { id: 86, name: "Borisaler Bhapa Murgi", prices: [289, 399], type: 'D', cat: "Bengal" },
            { id: 87, name: "Kacha Lanka Mangsho", price: 399, cat: "Bengal" },
            { id: 88, name: "Morich Mangsho", price: 399, cat: "Bengal" },
            { id: 89, name: "Ilish Bhapa", price: 349, cat: "Bengal" },
            { id: 90, name: "Begun Ilish", price: 319, cat: "Bengal" },
            { id: 91, name: "Chingri Malai Curry", price: 449, cat: "Bengal" },
            { id: 92, name: "Bhetki Bhapa", price: 499, cat: "Bengal" },
            { id: 93, name: "Bhetki Paturi", price: 349, cat: "Bengal" },
            { id: 94, name: "Katla Kalia", price: 199, cat: "Bengal" },
            { id: 95, name: "Katla Bhapa", price: 229, cat: "Bengal" },
            // CONTINENTAL
            { id: 96, name: "Arabita Pasta", prices: [249, 299], type: 'S', cat: "Continental" },
            { id: 97, name: "Mama Rossa Pasta", prices: [249, 299], type: 'S', cat: "Continental" },
            { id: 98, name: "Creamy Cheese Sauce Pasta", prices: [259, 309], type: 'S', cat: "Continental" },
            { id: 99, name: "Spaghetti Aglio E Olio", prices: [299, 349], type: 'A', cat: "Continental" },
            { id: 100, name: "Au Gratin", prices: [339, 369], type: 'A', cat: "Continental" },
            { id: 101, name: "Baked Pasta", prices: [299, 349], type: 'A', cat: "Continental" },
            { id: 102, name: "Chicken Stroganoff", price: 359, cat: "Continental" },
            { id: 103, name: "Cottage Cheese Steak Sizzler", price: 359, cat: "Continental" },
            { id: 104, name: "Grilled Fish with Lemon Butter Sauce", price: 429, cat: "Continental" },
            { id: 105, name: "Grilled Chicken Steak Sizzler", price: 349, cat: "Continental" },
            { id: 106, name: "Classic Margherita Pizza", price: 249, cat: "Continental" },
            { id: 107, name: "Paneer Makhni Pizza", price: 289, cat: "Continental" },
            { id: 108, name: "B.B.Q Chicken Pizza", price: 329, cat: "Continental" },
            { id: 109, name: "Chicken Makhani Pizza", price: 349, cat: "Continental" },
            // PAN ASIAN
            { id: 110, name: "Chinese Fried Rice", prices: [199, 249], type: 'A', cat: "Pan Asian" },
            { id: 111, name: "Schezwan Fried Rice", prices: [219, 259], type: 'A', cat: "Pan Asian" },
            { id: 112, name: "Burnt Garlic Fried Rice", prices: [219, 259], type: 'A', cat: "Pan Asian" },
            { id: 113, name: "Singaporean Rice", prices: [219, 259], type: 'A', cat: "Pan Asian" },
            { id: 114, name: "Mongolian Rice", prices: [249, 289], type: 'A', cat: "Pan Asian" },
            { id: 115, name: "Hakka Noodles", prices: [199, 249], type: 'A', cat: "Pan Asian" },
            { id: 116, name: "Chilli Garlic Hakka Noodles", prices: [219, 259], type: 'A', cat: "Pan Asian" },
            { id: 117, name: "Schezwan Hakka Noodles", prices: [219, 259], type: 'A', cat: "Pan Asian" },
            { id: 118, name: "Cantonese Noodles", prices: [249, 289], type: 'A', cat: "Pan Asian" },
            { id: 119, name: "Pan Fried Noodles", prices: [249, 289], type: 'A', cat: "Pan Asian" },
            { id: 120, name: "Mongolian Noodles", prices: [249, 289], type: 'A', cat: "Pan Asian" },
            { id: 121, name: "Paneer in Sauce", prices: [269, 269, 269, 269], type: 'Z', cat: "Pan Asian" },
            { id: 122, name: "Mushroom in Sauce", prices: [249, 249, 249, 249], type: 'Z', cat: "Pan Asian" },
            { id: 123, name: "Chicken in Sauce", prices: [279, 279, 279, 279, 279], type: 'P', cat: "Pan Asian" },
            { id: 124, name: "Fish in Sauce", prices: [339, 339, 339, 339, 339], type: 'P', cat: "Pan Asian" },
            { id: 125, name: "Prawn in Sauce", prices: [349, 349, 349, 349, 349], type: 'P', cat: "Pan Asian" },
            // DESSERT
            { id: 126, name: "Hot Chhanar Malpua", price: 119, cat: "Dessert" },
            { id: 127, name: "Bengali Baked Rasgulla", price: 119, cat: "Dessert" },
            { id: 128, name: "Blueberry Cheesecake", price: 159, cat: "Dessert" },
            { id: 129, name: "Brownie", price: 119, cat: "Dessert" },
            { id: 130, name: "Tutti Frutti Sundae", price: 139, cat: "Dessert" },
            { id: 131, name: "Ice Cream", prices: [99, 99, 99, 99], type: 'I', cat: "Dessert" }
        ];
        
        const CATEGORIES = ["All", ...new Set(MENU_DATA.map(i => i.cat))];
        const COUNTRY_CODES = [
            { code: "+91", label: "ðŸ‡®ðŸ‡³ +91" },
  { code: "+1", label: "ðŸ‡ºðŸ‡¸ +1" },
  { code: "+7", label: "ðŸ‡·ðŸ‡º +7" },
  { code: "+20", label: "ðŸ‡ªðŸ‡¬ +20" },
  { code: "+27", label: "ðŸ‡¿ðŸ‡¦ +27" },
  { code: "+30", label: "ðŸ‡¬ðŸ‡· +30" },
  { code: "+31", label: "ðŸ‡³ðŸ‡± +31" },
  { code: "+32", label: "ðŸ‡§ðŸ‡ª +32" },
  { code: "+33", label: "ðŸ‡«ðŸ‡· +33" },
  { code: "+34", label: "ðŸ‡ªðŸ‡¸ +34" },
  { code: "+36", label: "ðŸ‡­ðŸ‡º +36" },
  { code: "+39", label: "ðŸ‡®ðŸ‡¹ +39" },
  { code: "+40", label: "ðŸ‡·ðŸ‡´ +40" },
  { code: "+41", label: "ðŸ‡¨ðŸ‡­ +41" },
  { code: "+43", label: "ðŸ‡¦ðŸ‡¹ +43" },
  { code: "+44", label: "ðŸ‡¬ðŸ‡§ +44" },
  { code: "+45", label: "ðŸ‡©ðŸ‡° +45" },
  { code: "+46", label: "ðŸ‡¸ðŸ‡ª +46" },
  { code: "+47", label: "ðŸ‡³ðŸ‡´ +47" },
  { code: "+48", label: "ðŸ‡µðŸ‡± +48" },
  { code: "+49", label: "ðŸ‡©ðŸ‡ª +49" },
  { code: "+51", label: "ðŸ‡µðŸ‡ª +51" },
  { code: "+52", label: "ðŸ‡²ðŸ‡½ +52" },
  { code: "+53", label: "ðŸ‡¨ðŸ‡º +53" },
  { code: "+54", label: "ðŸ‡¦ðŸ‡· +54" },
  { code: "+55", label: "ðŸ‡§ðŸ‡· +55" },
  { code: "+56", label: "ðŸ‡¨ðŸ‡± +56" },
  { code: "+57", label: "ðŸ‡¨ðŸ‡´ +57" },
  { code: "+58", label: "ðŸ‡»ðŸ‡ª +58" },
  { code: "+60", label: "ðŸ‡²ðŸ‡¾ +60" },
  { code: "+61", label: "ðŸ‡¦ðŸ‡º +61" },
  { code: "+62", label: "ðŸ‡®ðŸ‡© +62" },
  { code: "+63", label: "ðŸ‡µðŸ‡­ +63" },
  { code: "+64", label: "ðŸ‡³ðŸ‡¿ +64" },
  { code: "+65", label: "ðŸ‡¸ðŸ‡¬ +65" },
  { code: "+66", label: "ðŸ‡¹ðŸ‡­ +66" },
  { code: "+81", label: "ðŸ‡¯ðŸ‡µ +81" },
  { code: "+82", label: "ðŸ‡°ðŸ‡· +82" },
  { code: "+84", label: "ðŸ‡»ðŸ‡³ +84" },
  { code: "+86", label: "ðŸ‡¨ðŸ‡³ +86" },
  { code: "+90", label: "ðŸ‡¹ðŸ‡· +90" },
  { code: "+92", label: "ðŸ‡µðŸ‡° +92" },
  { code: "+93", label: "ðŸ‡¦ðŸ‡« +93" },
  { code: "+94", label: "ðŸ‡±ðŸ‡° +94" },
  { code: "+95", label: "ðŸ‡²ðŸ‡² +95" },
  { code: "+98", label: "ðŸ‡®ðŸ‡· +98" },
  { code: "+211", label: "ðŸ‡¸ðŸ‡¸ +211" },
  { code: "+212", label: "ðŸ‡²ðŸ‡¦ +212" },
  { code: "+213", label: "ðŸ‡©ðŸ‡¿ +213" },
  { code: "+216", label: "ðŸ‡¹ðŸ‡³ +216" },
  { code: "+218", label: "ðŸ‡±ðŸ‡¾ +218" },
  { code: "+220", label: "ðŸ‡¬ðŸ‡² +220" },
  { code: "+221", label: "ðŸ‡¸ðŸ‡³ +221" },
  { code: "+222", label: "ðŸ‡²ðŸ‡· +222" },
  { code: "+223", label: "ðŸ‡²ðŸ‡± +223" },
  { code: "+224", label: "ðŸ‡¬ðŸ‡³ +224" },
  { code: "+225", label: "ðŸ‡¨ðŸ‡® +225" },
  { code: "+226", label: "ðŸ‡§ðŸ‡« +226" },
  { code: "+227", label: "ðŸ‡³ðŸ‡ª +227" },
  { code: "+228", label: "ðŸ‡¹ðŸ‡¬ +228" },
  { code: "+229", label: "ðŸ‡§ðŸ‡¯ +229" },
  { code: "+230", label: "ðŸ‡²ðŸ‡º +230" },
  { code: "+231", label: "ðŸ‡±ðŸ‡· +231" },
  { code: "+232", label: "ðŸ‡¸ðŸ‡± +232" },
  { code: "+233", label: "ðŸ‡¬ðŸ‡­ +233" },
  { code: "+234", label: "ðŸ‡³ðŸ‡¬ +234" },
  { code: "+235", label: "ðŸ‡¹ðŸ‡© +235" },
  { code: "+236", label: "ðŸ‡¨ðŸ‡« +236" },
  { code: "+237", label: "ðŸ‡¨ðŸ‡² +237" },
  { code: "+238", label: "ðŸ‡¨ðŸ‡» +238" },
  { code: "+239", label: "ðŸ‡¸ðŸ‡¹ +239" },
  { code: "+240", label: "ðŸ‡¬ðŸ‡¶ +240" },
  { code: "+241", label: "ðŸ‡¬ðŸ‡¦ +241" },
  { code: "+242", label: "ðŸ‡¨ðŸ‡¬ +242" },
  { code: "+243", label: "ðŸ‡¨ðŸ‡© +243" },
  { code: "+244", label: "ðŸ‡¦ðŸ‡´ +244" },
  { code: "+245", label: "ðŸ‡¬ðŸ‡¼ +245" },
  { code: "+246", label: "ðŸ‡®ðŸ‡´ +246" },
  { code: "+248", label: "ðŸ‡¸ðŸ‡¨ +248" },
  { code: "+249", label: "ðŸ‡¸ðŸ‡© +249" },
  { code: "+250", label: "ðŸ‡·ðŸ‡¼ +250" },
  { code: "+251", label: "ðŸ‡ªðŸ‡¹ +251" },
  { code: "+252", label: "ðŸ‡¸ðŸ‡´ +252" },
  { code: "+253", label: "ðŸ‡©ðŸ‡¯ +253" },
  { code: "+254", label: "ðŸ‡°ðŸ‡ª +254" },
  { code: "+255", label: "ðŸ‡¹ðŸ‡¿ +255" },
  { code: "+256", label: "ðŸ‡ºðŸ‡¬ +256" },
  { code: "+257", label: "ðŸ‡§ðŸ‡® +257" },
  { code: "+258", label: "ðŸ‡²ðŸ‡¿ +258" },
  { code: "+260", label: "ðŸ‡¿ðŸ‡² +260" },
  { code: "+261", label: "ðŸ‡²ðŸ‡¬ +261" },
  { code: "+262", label: "ðŸ‡·ðŸ‡ª +262" },
  { code: "+263", label: "ðŸ‡¿ðŸ‡¼ +263" },
  { code: "+264", label: "ðŸ‡³ðŸ‡¦ +264" },
  { code: "+265", label: "ðŸ‡²ðŸ‡¼ +265" },
  { code: "+266", label: "ðŸ‡±ðŸ‡¸ +266" },
  { code: "+267", label: "ðŸ‡§ðŸ‡¼ +267" },
  { code: "+268", label: "ðŸ‡¸ðŸ‡¿ +268" },
  { code: "+269", label: "ðŸ‡°ðŸ‡² +269" },
  { code: "+970", label: "ðŸ‡µðŸ‡¸ +970" },
  { code: "+971", label: "ðŸ‡¦ðŸ‡ª +971" },
  { code: "+972", label: "ðŸ‡®ðŸ‡± +972" },
  { code: "+973", label: "ðŸ‡§ðŸ‡­ +973" },
  { code: "+974", label: "ðŸ‡¶ðŸ‡¦ +974" },
  { code: "+975", label: "ðŸ‡§ðŸ‡¹ +975" },
  { code: "+976", label: "ðŸ‡²ðŸ‡³ +976" },
  { code: "+977", label: "ðŸ‡³ðŸ‡µ +977" },
  { code: "+992", label: "ðŸ‡¹ðŸ‡¯ +992" },
  { code: "+993", label: "ðŸ‡¹ðŸ‡² +993" },
  { code: "+994", label: "ðŸ‡¦ðŸ‡¿ +994" },
  { code: "+995", label: "ðŸ‡¬ðŸ‡ª +995" },
  { code: "+996", label: "ðŸ‡°ðŸ‡¬ +996" },
  { code: "+998", label: "ðŸ‡ºðŸ‡¿ +998" }
        ];

        window.state = {
            view: 'welcome',
            cart: [],
            activeCategory: 'All',
            phoneNumber: '',
            countryCode: '+91',
            roomNumber: '',
            activeOrderId: null,
            orders: [],
            user: null,
            staffId: 'Guest', 
            userRole: 'guest',
            isPlacingOrder: false,
            isLoadingLogin: false,
            variantModal: null,
            lookupError: '',
            lookupMethod: 'token',
            lookupCountryCode: '+91',
            formError: '',
            editingOrder: null,
            viewImage: null
        };

        window.setState = (update) => {
            window.state = { ...window.state, ...update };
            render();
        };

        // NEW: Strict Room Number Validation Logic
        function validateRoomNumber(room) {
            if (!room) return false;
            const r = room.toString().trim();
            const num = parseInt(r, 10);
            if (isNaN(num)) return false;
            if (num >= 1 && num <= 3) return true;
            if (num >= 101 && num <= 110) return true;
            if (num >= 201 && num <= 210) return true;
            if (num >= 301 && num <= 310) return true;
            if (num >= 401 && num <= 410) return true;
            return false;
        }

        // NEW: Get IST Time
        function getISTTime() {
            return new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });
        }

        async function initApp() {
            try {
                // Guests start anonymously
                const userCred = await signInAnonymously(auth);
                window.state.user = userCred.user;
                setupSync();
            } catch (e) { console.error("Auth failed:", e); }
        }

        window.handleLogin = async (portal, userId, password) => {
            if(!userId || !password) {
                alert("Please enter both User ID and Password.");
                return;
            }

            window.setState({ isLoadingLogin: true });

            const email = userId.includes('@') ? userId : `${userId}@mahfil.local`;
            const rawId = userId.split('@')[0].toLowerCase();
            
            // Look up the user in the AUTHORIZED_USERS list
            const authorizedUser = AUTHORIZED_USERS.find(u => u.id === rawId);

            try {
                await signInWithEmailAndPassword(auth, email, password);
                
                if (authorizedUser) {
                    window.setState({ 
                        staffId: authorizedUser.id,
                        userRole: authorizedUser.role 
                    });

                    if (portal === 'admin') {
                        if (authorizedUser.role === 'admin' || authorizedUser.role === 'manager') {
                            window.setState({ view: 'admin' });
                        } else {
                            alert("Access Denied: Admin or Manager privileges required.");
                            await signOut(auth);
                            await signInAnonymously(auth);
                            window.setState({ staffId: 'Guest', userRole: 'guest' });
                        }
                    } else if (portal === 'kitchen') {
                        window.setState({ view: 'kitchen' });
                    }
                } else {
                    // Fallback for old emails not in list (safety net)
                    console.warn("User authenticated but not in AUTHORIZED_USERS list.");
                     window.setState({ staffId: rawId, userRole: 'staff' });
                     if(portal === 'kitchen') window.setState({ view: 'kitchen' });
                     else alert("Account not authorized for this portal.");
                }

            } catch (error) {
                console.error(error);
                alert("Authentication Failed: Check ID and Password");
            } finally {
                window.setState({ isLoadingLogin: false });
            }
        };

        function setupSync() {
            const ordersRef = collection(db, 'artifacts', appId, 'public', 'data', 'orders');
            onSnapshot(ordersRef, (snapshot) => {
                const orders = [];
                snapshot.forEach(doc => orders.push({ cloudId: doc.id, ...doc.data() }));
                window.state.orders = orders.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                document.getElementById('loading-screen')?.classList.add('hidden');
                render();
            }, (error) => {
                console.log("Sync limited by security rules:", error.code);
            });
        }

        window.handleAddToCart = (item) => {
            if (item.prices) { window.setState({ variantModal: { item } }); return; }
            addToCartLogic(item.name, item.price, item.id);
        };

        window.addVariantToCart = (variantName, variantPrice) => {
            const item = window.state.variantModal.item;
            addToCartLogic(`${item.name} (${variantName})`, variantPrice, `${item.id}-${variantName}`);
            window.setState({ variantModal: null });
        };

        function addToCartLogic(displayName, price, uniqueId) {
            const existing = window.state.cart.find(i => i.uid === uniqueId);
            if (existing) { existing.qty++; }
            else { window.state.cart.push({ name: displayName, price, qty: 1, uid: uniqueId }); }
            render();
        }

        window.placeOrder = async () => {
            if (window.state.isPlacingOrder) return;

            const isValid = validateRoomNumber(window.state.roomNumber);
            if (!isValid) {
                window.setState({ formError: 'Room must be 1-3, 101-110, 201-210, 301-310, 401-410.' });
                return;
            }
            if (window.state.phoneNumber.length < 5) {
                window.setState({ formError: 'Please enter a valid phone number.' });
                return;
            }

            window.setState({ isPlacingOrder: true, formError: '' });
            try {
                const orderId = "MOT-" + Math.random().toString(36).substr(2, 4).toUpperCase();
                const subTotal = window.state.cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
                const fullPhone = window.state.countryCode + window.state.phoneNumber;
                const istTime = getISTTime();
                
                const newOrder = {
                    id: orderId,
                    room: window.state.roomNumber,
                    phone: fullPhone,
                    items: window.state.cart,
                    total: Math.round(subTotal * 1.05),
                    status: 0, 
                    timestamp: serverTimestamp(),
                    time: istTime,
                    statusTimes: { 0: istTime }, // Capture Received Time
                    logs: [{ user: 'Guest', action: 'Order Placed', time: istTime }]
                };

                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'orders'), newOrder);
                window.setState({ view: 'tracking', activeOrderId: orderId, cart: [], isPlacingOrder: false });
            } catch (err) { window.setState({ isPlacingOrder: false }); }
        };

        window.lookupOrder = () => {
            const method = window.state.lookupMethod;
            let order = null;

            if (method === 'token') {
                const token = document.getElementById('look-token').value.trim().toUpperCase();
                order = window.state.orders.find(o => o.id === token);
            } else {
                const room = document.getElementById('look-room').value.trim();
                const phoneInput = document.getElementById('look-phone').value.trim();
                const fullPhone = window.state.lookupCountryCode + phoneInput;
                
                order = window.state.orders.find(o => 
                    o.room === room && o.phone === fullPhone
                );
            }

            if (order) {
                window.setState({ activeOrderId: order.id, view: 'tracking', lookupError: '' });
            } else {
                window.setState({ lookupError: 'Order not found. Please check your details.' });
            }
        };

        window.updateStatus = async (cloudId, currentStatus, targetStatus) => {
            const statusMap = {0: "Received", 1: "Preparing", 2: "On Way", 3: "Served"};
            const statusText = statusMap[targetStatus] || "Updated";
            const istTime = getISTTime();

            const logEntry = {
                user: window.state.staffId,
                action: `Changed status to ${statusText}`,
                time: istTime
            };
            
            const updateData = { 
                status: targetStatus,
                logs: arrayUnion(logEntry),
                [`statusTimes.${targetStatus}`]: istTime 
            };

            if (targetStatus === 3) {
                const fileInput = document.getElementById(`photo-upload-${cloudId}`);
                if (!fileInput.files || !fileInput.files[0]) {
                    alert("Order completion requires a photo upload.");
                    return;
                }
                const reader = new FileReader();
                reader.onloadend = async () => {
                    updateData.completionPhoto = reader.result;
                    updateData.completedAt = serverTimestamp();
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId), updateData);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId), updateData);
            }
        };

        window.deleteOrder = async (cloudId) => {
            if(confirm("Permanently delete this order record? This cannot be undone.")) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId));
            }
        }

        // NEW: Remove Item from Edit Modal
        window.removeItemFromEdit = (index) => {
            if(!window.state.editingOrder) return;
            const order = { ...window.state.editingOrder };
            const items = [...order.items];
            
            items.splice(index, 1);
            order.items = items;
            
            window.setState({ editingOrder: order });
        };

        // NEW: Save Edited Order with Detailed Logging
        window.saveOrderEdit = async (cloudId) => {
            const newRoom = document.getElementById('edit-room').value;
            const newPhone = document.getElementById('edit-phone').value;
            const newTotal = parseInt(document.getElementById('edit-total').value);

            if(!newRoom || !newTotal) {
                alert("Room and Total are required");
                return;
            }

            // Construct items array from inputs
            const newItems = [];
            const itemRows = document.querySelectorAll('.edit-item-row');
            itemRows.forEach(row => {
                const name = row.querySelector('.edit-item-name').value;
                const price = parseInt(row.querySelector('.edit-item-price').value);
                const qty = parseInt(row.getAttribute('data-qty'));
                newItems.push({ name, price, qty, uid: row.getAttribute('data-uid') || 'modified' });
            });

            // Find original order to compare for logs
            const originalOrder = window.state.orders.find(o => o.cloudId === cloudId);
            const istTime = getISTTime();
            const logs = [];

            // Generate Diff Logs
            if (originalOrder.room !== newRoom) logs.push({ user: window.state.staffId, action: `Changed Room from ${originalOrder.room} to ${newRoom}`, time: istTime });
            if (originalOrder.phone !== newPhone) logs.push({ user: window.state.staffId, action: `Changed Phone from ${originalOrder.phone} to ${newPhone}`, time: istTime });
            if (originalOrder.total !== newTotal) logs.push({ user: window.state.staffId, action: `Changed Total from â‚¹${originalOrder.total} to â‚¹${newTotal}`, time: istTime });

            // Diff Items
            // Note: This logic assumes simple row-by-row correlation or length check for simplicity in this context
            if (originalOrder.items.length !== newItems.length) {
                logs.push({ user: window.state.staffId, action: `Changed Item Count from ${originalOrder.items.length} to ${newItems.length}`, time: istTime });
            }
            
            // Check for specific item changes (price or name)
            newItems.forEach((newItem, idx) => {
                if (originalOrder.items[idx]) {
                    const oldItem = originalOrder.items[idx];
                    if (newItem.price !== oldItem.price) {
                        logs.push({ user: window.state.staffId, action: `Changed price of ${newItem.name} from â‚¹${oldItem.price} to â‚¹${newItem.price}`, time: istTime });
                    }
                    if (newItem.name !== oldItem.name) {
                        logs.push({ user: window.state.staffId, action: `Renamed ${oldItem.name} to ${newItem.name}`, time: istTime });
                    }
                }
            });

            if(logs.length === 0) {
                logs.push({ user: window.state.staffId, action: 'Edited Order Details (No specifics detected)', time: istTime });
            }

            try {
                // We add new logs to existing ones. Firebase arrayUnion adds unique elements, 
                // but objects are unique by ref. So these push correctly.
                const updatePayload = {
                    room: newRoom, 
                    phone: newPhone,
                    total: newTotal,
                    items: newItems,
                    logs: arrayUnion(...logs)
                };

                await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'orders', cloudId), updatePayload);
                window.setState({ editingOrder: null });
            } catch(e) {
                alert("Error updating order: " + e.message);
            }
        };

        // NEW: Export Data to CSV
        window.exportData = () => {
            const headers = ["Order ID", "Date", "Room", "Phone", "Items", "Total", "Status"];
            const statusMap = ["Received", "Preparing", "On Way", "Served"];
            
            const rows = window.state.orders.map(o => [
                o.id,
                o.time.replace(/,/g, ''), // remove commas to not break csv
                o.room,
                o.phone,
                `"${o.items.map(i => `${i.qty}x ${i.name}`).join('; ')}"`, // quote items
                o.total,
                statusMap[o.status] || "Unknown"
            ]);

            const csvContent = "data:text/csv;charset=utf-8," 
                + headers.join(",") + "\n" 
                + rows.map(e => e.join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Mahfil_Orders_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function render() {
            const container = document.getElementById('main-content');
            if (!container) return;
            const cartCount = window.state.cart.reduce((a, b) => a + b.qty, 0);

            const Header = (title, backFn) => `
                <header class="p-6 shrink-0 z-40 flex justify-between items-center glass-header sticky top-0">
                    <h2 onclick="${backFn ? backFn : "setState({view: 'welcome'})"}" class="font-bold text-xl text-royal-blue tracking-tight flex items-center gap-2 cursor-pointer group">
                        ${backFn ? '<div class="bg-silver-plate p-2 rounded-full group-hover:bg-silver-metal/20 transition-colors"><i data-lucide="chevron-left" class="w-6 h-6 text-royal-blue"></i></div>' : ''}
                        ${title}
                    </h2>
                    ${window.state.view !== 'welcome' && !['kitchen','kitchen_login','admin','admin_login','menu_view'].includes(window.state.view) ? `
                    <div class="flex bg-silver-plate p-1 rounded-2xl border border-silver-metal/20 shadow-inner">
                        <button onclick="setState({view: 'user'})" class="px-5 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider transition-all ${window.state.view === 'user' ? 'primary-button shadow-lg' : 'text-royal-blue/60 hover:text-royal-blue'}">Menu</button>
                        <button onclick="setState({view: 'order_lookup'})" class="px-5 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wider transition-all ${['order_lookup','tracking'].includes(window.state.view) ? 'primary-button shadow-lg' : 'text-royal-blue/60 hover:text-royal-blue'}">Track</button>
                    </div>` : ''}
                </header>
            `;

            if (window.state.view === 'welcome') {
                container.innerHTML = `
                    <div class="flex-1 flex flex-col justify-between p-8 text-center animate-slide-up relative h-full overflow-y-auto custom-scrollbar bg-gradient-to-br from-silver-mist via-white to-silver-plate">
                        <div class="absolute -top-20 -left-20 w-64 h-64 bg-royal-blue/10 rounded-full mix-blend-multiply filter blur-[60px] animate-blob"></div>
                        <div class="absolute -bottom-20 -right-20 w-64 h-64 bg-garden-green/10 rounded-full mix-blend-multiply filter blur-[60px] animate-blob" style="animation-delay: 2s"></div>

                        <div class="flex-1 flex flex-col items-center justify-center z-10 min-h-[300px]">
                            <h1 class="text-6xl md:text-8xl font-black tracking-tighter text-royal-blue leading-[0.9] pb-4 drop-shadow-sm">
                                Mahfil-e<br><span class="text-silver-metal">Motijheel</span>
                            </h1>
                            <p class="text-royal-blue-light font-bold text-sm md:text-base uppercase tracking-[0.4em] inline-block border-t border-royal-blue/20 pt-6 mt-2 mb-12">Royal Room Service</p>
                        </div>
                        
                        <div class="w-full max-w-sm space-y-6 relative z-10 mx-auto mb-16">
                            <button onclick="setState({view: 'user'})" class="w-full primary-button p-6 rounded-2xl font-black text-2xl shadow-xl active:scale-95 transition-all flex items-center justify-center gap-3">
                                <i data-lucide="bell-ring" class="w-7 h-7 fill-current"></i> Order Service
                            </button>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="setState({view: 'menu_view'})" class="glass-panel text-royal-blue p-5 rounded-2xl font-black text-lg hover:bg-white transition-all flex items-center justify-center gap-2 border-silver-metal/20">
                                    <i data-lucide="book-open" class="w-6 h-6 text-garden-green"></i> Menu PDF
                                </button>
                                <button onclick="setState({view: 'order_lookup'})" class="glass-panel text-royal-blue p-5 rounded-2xl font-black text-lg hover:bg-white transition-all flex items-center justify-center gap-2 border-silver-metal/20">
                                    <i data-lucide="radar" class="w-6 h-6 text-garden-green"></i> Status
                                </button>
                            </div>
                        </div>

                        <div class="w-full flex justify-between px-2 text-royal-blue/50 z-10 pb-4 items-center gap-2">
                            <button onclick="setState({view: 'admin_login'})" class="hover:text-royal-blue transition-colors p-2"><i data-lucide="shield" class="w-7 h-7"></i></button>
                            
                            <div class="flex gap-2">
                                <a href="tel:+918001365465" class="text-royal-blue font-bold text-xs flex items-center gap-1 bg-white/60 px-4 py-3 rounded-full border border-silver-metal/20 hover:bg-white transition-all backdrop-blur-sm shadow-sm">
                                    <i data-lucide="phone" class="w-3 h-3 text-garden-green"></i> Reception
                                </a>
                                <a href="https://www.motijheelpark.com" class="text-white font-bold text-xs flex items-center gap-1 bg-royal-blue/80 px-4 py-3 rounded-full border border-royal-blue/20 hover:bg-royal-blue transition-all backdrop-blur-sm shadow-sm">
                                    <i data-lucide="arrow-left-circle" class="w-3 h-3 text-white"></i> Want to go back?
                                </a>
                            </div>

                            <button onclick="setState({view: 'kitchen_login'})" class="hover:text-royal-blue transition-colors p-2"><i data-lucide="chef-hat" class="w-7 h-7"></i></button>
                        </div>
                    </div>
                `;
            } 
            else if (['user', 'checkout', 'tracking', 'order_lookup'].includes(window.state.view)) {
                container.innerHTML = `
                    <div class="flex-1 flex flex-col h-full animate-slide-up relative bg-silver-mist">
                        ${Header(window.state.view === 'checkout' ? 'Confirm Service' : window.state.view === 'tracking' ? 'Room Service' : window.state.view === 'order_lookup' ? 'Track Request' : 'In-Room Dining', window.state.view === 'user' ? "setState({view: 'welcome'})" : null)}
                        
                        <main class="flex-1 overflow-y-auto p-4 md:p-6 pb-32 custom-scrollbar relative z-10">
                            ${window.state.view === 'user' ? `
                                <div class="max-w-4xl mx-auto mt-2">
                                    <div class="flex gap-3 overflow-x-auto custom-scrollbar pb-4 mb-2 sticky top-0 bg-transparent z-30 pt-2 backdrop-blur-sm">
                                        ${CATEGORIES.map(c => `
                                            <button onclick="setState({activeCategory: '${c}'})" class="whitespace-nowrap px-6 py-3 rounded-full text-xs font-bold uppercase tracking-wider border transition-all ${window.state.activeCategory === c ? 'primary-button border-garden-green shadow-lg scale-105' : 'bg-white text-royal-blue border-silver-metal/20 hover:border-garden-green hover:bg-garden-green-pale'}">${c}</button>
                                        `).join('')}
                                    </div>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-5">
                                        ${MENU_DATA.filter(m => window.state.activeCategory === 'All' || m.cat === window.state.activeCategory).map(item => `
                                            <div class="bg-white p-6 rounded-[1.8rem] border border-silver-plate flex justify-between items-center group hover:border-royal-blue hover:shadow-xl transition-all shadow-sm">
                                                <div class="flex-1 pr-4">
                                                    <h3 class="font-bold text-royal-blue text-lg leading-tight">${item.name}</h3>
                                                    ${item.desc ? `<p class="text-xs text-silver-metal mt-1 line-clamp-2">${item.desc}</p>` : ''}
                                                    <p class="text-garden-green-dark font-black text-lg mt-2">${item.price ? 'â‚¹'+item.price : '<span class="text-[10px] text-silver-metal font-normal uppercase mr-1">Starts</span> â‚¹'+item.prices[0]}</p>
                                                </div>
                                                <button onclick="handleAddToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" class="h-14 w-14 rounded-2xl flex items-center justify-center text-white primary-button shadow-lg active:scale-90 transition-all hover:brightness-110">
                                                    <i data-lucide="plus" class="w-7 h-7"></i>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            ${window.state.view === 'checkout' ? `
                                <div class="max-w-lg mx-auto space-y-6">
                                    <div class="glass-panel p-8 rounded-[2rem] space-y-5 bg-white">
                                        <div class="flex items-center gap-3 mb-2">
                                            <div class="w-12 h-12 rounded-full bg-garden-green-pale flex items-center justify-center text-garden-green-dark border border-garden-green/20"><i data-lucide="door-closed" class="w-6 h-6"></i></div>
                                            <h3 class="font-black text-xl text-royal-blue">Room Details</h3>
                                        </div>
                                        
                                        ${window.state.formError ? `
                                            <div class="bg-red-50 border border-red-100 text-red-800 p-4 rounded-xl text-sm font-bold text-center flex items-center justify-center gap-2 animate-pulse">
                                                <i data-lucide="alert-circle" class="w-4 h-4"></i> ${window.state.formError}
                                            </div>
                                        ` : ''}
                                        
                                        <input type="text" placeholder="Room Number (e.g., 204)" oninput="window.state.roomNumber=this.value" value="${window.state.roomNumber}" class="w-full p-6 bg-silver-mist border border-silver-metal/20 rounded-2xl outline-none font-bold text-xl text-royal-blue focus:border-royal-blue focus:ring-4 focus:ring-royal-blue/5 transition-all shadow-inner">
                                        <p class="text-xs text-silver-metal pl-2">Allowed: 101-110, 201-210, 301-310, 401-410, 001-003.</p>
                                        
                                        <div class="flex gap-3">
                                            <select onchange="window.state.countryCode=this.value" class="p-5 bg-silver-mist border border-silver-metal/20 rounded-2xl outline-none font-bold text-lg min-w-[100px] text-royal-blue focus:border-royal-blue">
                                                ${COUNTRY_CODES.map(c => `<option value="${c.code}" ${c.code === window.state.countryCode ? 'selected' : ''}>${c.label}</option>`).join('')}
                                            </select>
                                            <input type="tel" placeholder="Phone Number" oninput="window.state.phoneNumber=this.value" value="${window.state.phoneNumber}" class="flex-1 p-5 bg-silver-mist border border-silver-metal/20 rounded-2xl outline-none font-bold text-lg text-royal-blue focus:border-royal-blue">
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gradient-to-br from-royal-blue to-black p-8 rounded-[2rem] shadow-xl relative overflow-hidden text-white border border-white/10">
                                        <h3 class="font-bold text-2xl mb-6 flex items-center gap-3"><i data-lucide="receipt" class="w-6 h-6 text-garden-green"></i> Order Summary</h3>
                                        <div class="space-y-4 mb-6 border-b border-white/20 pb-6 border-dashed">
                                            ${window.state.cart.map(i => `<div class="flex justify-between items-start text-base text-gray-300"><span class="flex gap-3"><span class="font-black text-white">${i.qty}x</span><span>${i.name}</span></span><span class="font-bold text-white">â‚¹${i.price * i.qty}</span></div>`).join('')}
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="font-bold text-white/70 text-xs uppercase tracking-widest mb-1">Total Bill To Room</span>
                                            <span class="text-4xl font-black text-white drop-shadow-md">â‚¹${Math.round(window.state.cart.reduce((a,b)=>a+(b.price*b.qty),0)*1.05)}</span>
                                        </div>
                                    </div>
                                    <button onclick="placeOrder()" class="w-full ${window.state.isPlacingOrder ? 'bg-gray-400' : 'primary-button'} p-6 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-[0.98] py-6">
                                        ${window.state.isPlacingOrder ? 'Submitting Request...' : 'Confirm Room Service'}
                                    </button>
                                </div>
                            ` : ''}

                            ${window.state.view === 'order_lookup' ? `
                                <div class="max-w-md mx-auto py-12">
                                    <div class="mb-12 flex flex-col items-center text-center">
                                        <div class="w-28 h-28 bg-white border border-silver-metal/20 rounded-full flex items-center justify-center mb-8 shadow-xl relative">
                                            <div class="absolute inset-0 rounded-full border border-garden-green opacity-30 animate-ping"></div>
                                            <i data-lucide="concierge-bell" class="text-royal-blue w-12 h-12"></i>
                                        </div>
                                        <h2 class="font-black text-4xl text-royal-blue">Service Status</h2>
                                    </div>
                                    <div class="flex p-1.5 bg-white border border-silver-metal/20 rounded-2xl mb-10 shadow-sm">
                                        <button onclick="setState({lookupMethod: 'token', lookupError: ''})" class="flex-1 py-4 rounded-xl text-sm font-black uppercase tracking-wider transition-all ${window.state.lookupMethod === 'token' ? 'primary-button shadow-md' : 'text-royal-blue/60 hover:text-royal-blue'}">Token</button>
                                        <button onclick="setState({lookupMethod: 'details', lookupError: ''})" class="flex-1 py-4 rounded-xl text-sm font-black uppercase tracking-wider transition-all ${window.state.lookupMethod === 'details' ? 'primary-button shadow-md' : 'text-royal-blue/60 hover:text-royal-blue'}">Room</button>
                                    </div>
                                    ${window.state.lookupError ? `<p class="bg-red-50 text-red-500 text-[10px] font-black p-4 rounded-2xl text-center border border-red-100 mb-6 animate-slide-up">${window.state.lookupError}</p>` : ''}
                                    
                                    <div class="space-y-5">
                                        ${window.state.lookupMethod === 'token' ? `
                                            <input type="text" id="look-token" placeholder="MOT-XXXX" class="w-full p-6 bg-white border border-silver-metal/20 rounded-2xl font-black outline-none focus:border-garden-green transition-all uppercase text-center tracking-[0.2em] text-2xl text-royal-blue shadow-inner">
                                        ` : `
                                            <div class="space-y-4">
                                                <input type="text" id="look-room" placeholder="Room Number" class="w-full p-6 bg-white border border-silver-metal/20 rounded-2xl font-bold text-lg text-royal-blue outline-none focus:border-garden-green shadow-inner">
                                                <div class="flex gap-2">
                                                    <select onchange="window.state.lookupCountryCode=this.value" class="p-6 bg-white border border-silver-metal/20 rounded-2xl outline-none font-bold min-w-[100px] text-center focus:border-garden-green text-royal-blue">
                                                        ${COUNTRY_CODES.map(c => `<option value="${c.code}" ${c.code === window.state.lookupCountryCode ? 'selected' : ''}>${c.label}</option>`).join('')}
                                                    </select>
                                                    <input type="tel" id="look-phone" placeholder="Phone Number" class="flex-1 p-6 bg-white border border-silver-metal/20 rounded-2xl font-bold text-lg text-royal-blue outline-none focus:border-garden-green shadow-inner">
                                                </div>
                                            </div>
                                        `}
                                        <button onclick="lookupOrder()" class="w-full primary-button p-6 rounded-2xl font-black text-xl shadow-lg mt-6 active:scale-95 transition-all">Track Service</button>
                                    </div>
                                </div>
                            ` : ''}

                            ${window.state.view === 'tracking' ? `
                                <div class="flex flex-col items-center py-8 max-w-sm mx-auto">
                                    ${(()=>{
                                        const order = window.state.orders.find(o => o.id === window.state.activeOrderId);
                                        if (!order) return `<div class="animate-pulse text-royal-blue font-bold text-xl">LOCATING REQUEST...</div>`;
                                        const steps = ["Received", "Preparing", "On the Way", "Served"];
                                        
                                        return `
                                            <div class="bg-gradient-to-br from-royal-blue to-black border border-silver-metal/30 w-full rounded-[2.5rem] p-10 text-center shadow-2xl mb-12 relative overflow-hidden">
                                                <div class="absolute -top-10 -left-10 w-40 h-40 bg-garden-green blur-[60px] opacity-20"></div>
                                                <p class="text-xs font-black tracking-[0.3em] text-silver-metal mb-3 uppercase">#${order.id}</p>
                                                <h2 class="text-4xl font-black mb-2 text-white">${steps[order.status]}</h2>
                                                <p class="text-sm text-white/80 font-medium px-4 mt-2 border-t border-white/10 pt-2 inline-block">Room ${order.room}</p>
                                            </div>
                                            <div class="w-full space-y-0 relative pl-6 mb-8">
                                                 <div class="absolute left-[31px] top-5 bottom-12 w-1 bg-royal-blue/10 rounded-full"></div>
                                                ${steps.map((s, idx) => {
                                                    const timestamp = order.statusTimes?.[idx] || ''; 
                                                    const displayTime = timestamp ? timestamp.split(',')[1].trim() : '';

                                                    return `
                                                    <div class="flex items-start gap-8 pb-12 relative z-10">
                                                        <div class="w-8 h-8 rounded-full border-[3px] flex items-center justify-center bg-white z-20 ${order.status >= idx ? 'bg-garden-green border-garden-green shadow-[0_0_20px_rgba(34,197,94,0.4)] scale-110' : 'border-gray-200'}">
                                                            ${order.status >= idx ? '<i data-lucide="check" class="w-4 h-4 text-white"></i>' : ''}
                                                        </div>
                                                        <div class="flex flex-col -mt-1.5">
                                                            <span class="font-bold text-lg ${order.status >= idx ? 'text-royal-blue' : 'text-gray-400'}">${s}</span>
                                                            <span class="text-xs font-bold uppercase tracking-wide mt-1 ${order.status === idx ? 'text-garden-green-dark animate-pulse' : 'text-gray-400'}">
                                                                ${order.status === idx ? 'In Progress' : order.status > idx ? 'Completed' : 'Pending'}
                                                                ${displayTime ? `<span class="block text-silver-metal font-normal mt-0.5">${displayTime} IST</span>` : ''}
                                                            </span>
                                                        </div>
                                                    </div>
                                                `}).join('')}
                                            </div>

                                            <div class="w-full bg-white p-6 rounded-3xl border border-silver-metal/20 shadow-lg">
                                                <h3 class="text-lg font-black text-royal-blue mb-4 flex items-center gap-2"><i data-lucide="receipt" class="w-5 h-5"></i> Order Details</h3>
                                                <div class="space-y-3 mb-4">
                                                    ${order.items.map(i => `
                                                        <div class="flex justify-between text-sm">
                                                            <span class="text-gray-600"><span class="font-bold text-royal-blue">${i.qty}x</span> ${i.name}</span>
                                                            <span class="font-bold text-gray-800">â‚¹${i.price * i.qty}</span>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                                <div class="border-t border-dashed border-silver-metal pt-3 flex justify-between items-center">
                                                    <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">Total Bill</span>
                                                    <span class="text-2xl font-black text-royal-blue">â‚¹${order.total}</span>
                                                </div>
                                            </div>

                                            ${order.completionPhoto ? `
                                                <div class="w-full mt-6 bg-white p-2 rounded-3xl border border-silver-metal/20 shadow-lg cursor-pointer group" onclick="setState({viewImage: '${order.completionPhoto}'})">
                                                    <div class="relative rounded-2xl overflow-hidden">
                                                        <img src="${order.completionPhoto}" class="w-full h-auto object-contain">
                                                        <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <span class="text-white font-bold text-xs uppercase tracking-widest border border-white px-4 py-2 rounded-full backdrop-blur-sm">View Proof</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        `;
                                    })()}
                                </div>
                            ` : ''}
                        </main>

                        ${window.state.view === 'user' && cartCount > 0 ? `
                            <div class="fixed-bottom-center animate-slide-up">
                                <button onclick="setState({view: 'checkout'})" class="w-full bg-royal-blue text-white p-5 rounded-2xl flex justify-between items-center shadow-2xl font-bold hover:scale-[1.02] transition-transform border-2 border-silver-metal/30 backdrop-blur-md">
                                    <span class="flex items-center gap-5">
                                        <span class="bg-white text-royal-blue w-12 h-12 rounded-xl flex items-center justify-center text-lg font-black shadow-lg border-2 border-royal-blue/10">${cartCount}</span>
                                        <span class="text-white font-black text-2xl">â‚¹${window.state.cart.reduce((a,b)=>a+(b.price*b.qty),0)}</span>
                                    </span>
                                    <span class="uppercase tracking-widest text-xs font-black flex items-center gap-2 bg-white/10 px-4 py-2 rounded-lg">Review <i data-lucide="arrow-right" class="w-4 h-4 text-garden-green"></i></span>
                                </button>
                            </div>
                        ` : ''}

                        ${window.state.variantModal ? `
                            <div class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-4 bg-royal-blue/20 backdrop-blur-sm">
                                <div class="bg-white border border-silver-metal/20 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl flex flex-col items-center animate-slide-up">
                                    <h3 class="font-black text-2xl text-royal-blue mb-1">${window.state.variantModal.item.name}</h3>
                                    <p class="text-silver-metal text-xs font-bold uppercase tracking-[0.2em] mb-8">Select Preference</p>
                                    <div class="w-full space-y-4">
                                        ${window.state.variantModal.item.prices.map((price, idx) => {
                                            const label = VARIANT_MAPS[window.state.variantModal.item.type]?.[idx] || 'Option ' + (idx+1);
                                            return `<button onclick="addVariantToCart('${label}', ${price})" class="w-full p-5 rounded-2xl bg-silver-mist border-2 border-silver-plate hover:border-garden-green hover:bg-garden-green-pale flex justify-between items-center transition-all group shadow-sm hover:shadow-md"><span class="font-bold text-lg text-royal-blue group-hover:text-garden-green-dark">${label}</span><span class="font-black text-xl text-garden-green-dark">â‚¹${price}</span></button>`;
                                        }).join('')}
                                    </div>
                                    <button onclick="setState({variantModal: null})" class="mt-8 text-gray-400 text-sm font-bold uppercase tracking-widest hover:text-royal-blue transition-colors p-2">Cancel</button>
                                </div>
                            </div>
                        ` : ''}

                        ${window.state.viewImage ? `
                            <div class="fixed inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center p-4 animate-slide-up">
                                <button onclick="setState({viewImage: null})" class="absolute top-6 right-6 bg-white/10 text-white hover:bg-white hover:text-black p-3 rounded-full transition-all backdrop-blur-md">
                                    <i data-lucide="x" class="w-8 h-8"></i>
                                </button>
                                <img src="${window.state.viewImage}" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
                            </div>
                        ` : ''}
                    </div>
                `;
            } 
            else if (['kitchen_login', 'kitchen'].includes(window.state.view)) {
                container.innerHTML = `
                    <div class="flex-1 bg-royal-blue text-white flex flex-col h-full overflow-hidden">
                        ${window.state.view === 'kitchen_login' ? `
                            <div class="flex-1 flex flex-col items-center justify-center p-8 bg-royal-blue/95 relative">
                                <button onclick="setState({view: 'welcome'})" class="absolute top-6 right-6 text-white/50 hover:text-white transition-colors"><i data-lucide="x" class="w-8 h-8"></i></button>
                                <div class="w-20 h-20 bg-white rounded-3xl flex items-center justify-center mb-8 shadow-xl"><i data-lucide="chef-hat" class="w-10 h-10 text-royal-blue"></i></div>
                                <h2 class="text-3xl font-black mb-10 text-white tracking-tight">Kitchen Portal</h2>
                                
                                <div class="w-full max-w-xs space-y-4">
                                    <input id="kit-id" type="text" placeholder="User ID" class="w-full bg-black/20 border-2 border-white/10 p-6 rounded-2xl text-center text-white font-bold tracking-widest text-lg focus:border-garden-green outline-none transition-all placeholder:text-white/30">
                                    <input id="kit-pwd" type="password" placeholder="Password" class="w-full bg-black/20 border-2 border-white/10 p-6 rounded-2xl text-center text-white font-bold tracking-widest text-lg focus:border-garden-green outline-none transition-all placeholder:text-white/30">
                                </div>
                                
                                <button onclick="window.handleLogin('kitchen', document.getElementById('kit-id').value, document.getElementById('kit-pwd').value)" class="w-full max-w-xs bg-white text-royal-blue p-6 rounded-2xl font-black text-xl shadow-lg mt-6 flex justify-center items-center">
                                    ${window.state.isLoadingLogin ? '<div class="btn-spinner border-royal-blue border-t-transparent"></div>' : 'Authenticate'}
                                </button>
                            </div>
                        ` : `
                            <header class="p-8 border-b border-white/10 shrink-0 flex justify-between items-center bg-black/10">
                                <h2 class="font-black text-2xl text-white flex items-center gap-3"><i data-lucide="utensils-crossed" class="w-6 h-6"></i> Room Service Orders</h2>
                                <button onclick="setState({view:'welcome'})" class="bg-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors border border-white/5 text-white"><i data-lucide="log-out" class="w-5 h-5"></i> EXIT</button>
                            </header>
                            <div class="flex-1 overflow-y-auto p-8 space-y-6 bg-black/20 custom-scrollbar">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    ${window.state.orders.map(o => `
                                        <div class="bg-white/5 p-8 rounded-3xl border border-white/10 shadow-lg">
                                            <div class="flex justify-between items-start mb-6 border-b border-white/10 pb-6">
                                                <div class="flex-1 pr-4">
                                                    <h4 class="font-bold text-lg text-silver-metal leading-tight">Room ${o.room}</h4>
                                                    <p class="text-sm text-gray-400 mt-2 font-mono">${o.id} â€¢ ${o.phone}</p>
                                                </div>
                                                <div class="text-right"><span class="block text-3xl font-black text-white">â‚¹${o.total}</span></div>
                                            </div>
                                            <div class="bg-black/40 rounded-2xl p-6 text-sm space-y-3 border border-white/5 mb-8 font-mono text-gray-300 shadow-inner">
                                                ${o.items.map(i => `<div class="flex justify-between border-b border-white/5 pb-2 last:border-0 last:pb-0"><span><span class="text-silver-metal font-bold text-lg mr-2">${i.qty}</span> ${i.name.toUpperCase()}</span></div>`).join('')}
                                            </div>
                                            <div class="flex items-center justify-between gap-2 bg-black/20 p-2 rounded-2xl">
                                                ${["Recv", "Prep", "Way", "Done"].map((s, idx) => {
                                                    const isNext = idx === o.status + 1;
                                                    const isCurrent = idx === o.status;
                                                    if(idx === 3 && isNext) return `<label class="flex-1 cursor-pointer bg-garden-green/10 hover:bg-garden-green/20 text-garden-green py-4 rounded-xl flex items-center justify-center border-2 border-dashed border-garden-green/30 transition-all"><i data-lucide="camera" class="w-5 h-5 mr-2"></i> DONE<input type="file" id="photo-upload-${o.cloudId}" class="hidden" accept="image/*" capture="environment" onchange="updateStatus('${o.cloudId}', ${o.status}, 3)"></label>`;
                                                    return `<button onclick="updateStatus('${o.cloudId}', ${o.status}, ${idx})" class="flex-1 py-4 rounded-xl text-xs font-black uppercase transition-all ${isCurrent ? 'bg-white text-royal-blue shadow-lg scale-105' : isNext ? 'bg-white/10 text-gray-200 hover:bg-white/20' : 'text-gray-600 cursor-not-allowed'}">${s}</button>`;
                                                }).join('')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `}
                    </div>
                `;
            }
            else if (['admin_login', 'admin'].includes(window.state.view)) {
                container.innerHTML = `
                    <div class="flex-1 bg-silver-mist flex flex-col h-full overflow-hidden text-royal-blue">
                        ${window.state.view === 'admin_login' ? `
                            <div class="flex-1 flex flex-col items-center justify-center p-8 bg-white relative">
                                <button onclick="setState({view: 'welcome'})" class="absolute top-6 right-6 text-silver-metal hover:text-royal-blue transition-colors"><i data-lucide="x" class="w-8 h-8"></i></button>
                                <div class="w-20 h-20 bg-royal-blue rounded-3xl flex items-center justify-center mb-8 text-white shadow-2xl"><i data-lucide="settings" class="w-10 h-10"></i></div>
                                <h2 class="text-3xl font-black mb-10 text-royal-blue tracking-tight">Admin Access</h2>
                                
                                <div class="w-full max-w-xs space-y-4">
                                    <input id="adm-id" type="text" placeholder="User ID" class="w-full bg-silver-mist border-2 border-silver-plate p-6 rounded-2xl text-center text-royal-blue font-bold tracking-widest text-lg focus:border-royal-blue outline-none transition-all placeholder:text-royal-blue/30">
                                    <input id="adm-pwd" type="password" placeholder="Password" class="w-full bg-silver-mist border-2 border-silver-plate p-6 rounded-2xl text-center text-royal-blue font-bold tracking-widest text-lg focus:border-royal-blue outline-none transition-all placeholder:text-royal-blue/30">
                                </div>

                                <button onclick="window.handleLogin('admin', document.getElementById('adm-id').value, document.getElementById('adm-pwd').value)" class="w-full max-w-xs primary-button p-6 rounded-2xl font-black text-xl shadow-lg mt-6 flex justify-center items-center">
                                    ${window.state.isLoadingLogin ? '<div class="btn-spinner border-white border-t-transparent"></div>' : 'Authenticate'}
                                </button>
                            </div>
                        ` : `
                            <header class="p-8 border-b border-silver-plate shrink-0 flex justify-between items-center shadow-sm z-10 bg-white">
                                <h2 class="font-black text-2xl text-royal-blue flex items-center gap-3"><i data-lucide="database" class="w-6 h-6 text-garden-green"></i> Master Database</h2>
                                <div class="flex gap-2">
                                    <button onclick="exportData()" class="bg-silver-mist p-4 rounded-2xl hover:bg-garden-green hover:text-white transition-colors border border-silver-plate font-bold flex items-center gap-2"><i data-lucide="download" class="w-5 h-5"></i> CSV</button>
                                    <button onclick="setState({view:'welcome'})" class="bg-silver-mist p-4 rounded-2xl hover:bg-royal-blue/10 text-royal-blue border border-silver-plate font-bold flex items-center gap-2"><i data-lucide="x" class="w-5 h-5"></i> EXIT</button>
                                </div>
                            </header>
                            <div class="flex-1 overflow-y-auto p-8 space-y-8 custom-scrollbar bg-silver-mist">
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                    ${window.state.orders.map(o => `
                                        <div class="bg-white p-8 rounded-[2rem] border border-silver-plate shadow-sm flex flex-col hover:border-royal-blue/30 transition-all hover:shadow-xl relative group">
                                            <div class="flex justify-between items-start mb-6">
                                                <div class="flex-1 pr-3">
                                                    <span class="text-[10px] font-black bg-silver-mist text-royal-blue px-3 py-1 rounded-full border border-silver-metal/20 mb-3 inline-block font-mono tracking-wider">${o.id}</span>
                                                    <h3 class="font-bold text-lg text-royal-blue leading-snug">Room ${o.room}</h3>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button onclick='setState({editingOrder: ${JSON.stringify(o).replace(/'/g, "&#39;") }})' class="text-royal-blue p-3 bg-silver-mist hover:bg-royal-blue hover:text-white rounded-xl transition-colors border border-silver-plate"><i data-lucide="pencil" class="w-5 h-5"></i></button>
                                                    ${window.state.userRole === 'admin' ? `<button onclick="deleteOrder('${o.cloudId}')" class="text-red-300 p-3 hover:bg-red-50 hover:text-red-600 rounded-xl transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>` : ''}
                                                </div>
                                            </div>
                                            
                                            <div class="space-y-3 mb-6 border-t border-dashed border-silver-plate pt-6">
                                                ${o.items.map(i => `<div class="text-sm flex justify-between text-gray-500 font-medium"><span><span class="font-black text-royal-blue">${i.qty}</span> ${i.name}</span><span class="font-mono text-garden-green-dark font-bold">â‚¹${i.price*i.qty}</span></div>`).join('')}
                                            </div>

                                            ${o.logs && o.logs.length > 0 ? `
                                                <div class="mb-6 bg-silver-mist p-4 rounded-xl border border-silver-plate/50">
                                                    <p class="text-[10px] font-bold text-silver-metal uppercase tracking-wider mb-2">Staff Activity Log</p>
                                                    <div class="space-y-2 max-h-32 overflow-y-auto custom-scrollbar">
                                                        ${o.logs.slice().reverse().map(log => `
                                                            <div class="text-[10px] flex justify-between items-start border-b border-silver-plate/50 pb-1 last:border-0">
                                                                <span class="text-royal-blue font-bold">${log.user}: <span class="text-gray-500 font-normal">${log.action}</span></span>
                                                                <span class="text-silver-metal whitespace-nowrap ml-2">${log.time.split(',')[1].trim().slice(0,5)}</span>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            ` : ''}

                                            ${o.completionPhoto ? `
                                                <div class="mt-2 mb-6 rounded-2xl border-2 border-silver-plate bg-gray-50 p-2 text-center group-image cursor-pointer hover:border-royal-blue transition-colors" onclick="setState({viewImage: '${o.completionPhoto}'})">
                                                    <img src="${o.completionPhoto}" class="w-full h-auto max-h-48 object-contain mx-auto">
                                                    <p class="text-[10px] text-gray-400 mt-2 font-bold uppercase tracking-widest group-image-hover:text-royal-blue">Click to Expand</p>
                                                </div>
                                            ` : ''}
                                            
                                            <div class="mt-auto pt-4 border-t border-silver-plate">
                                                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-2">Modify Status</p>
                                                <div class="flex gap-1 mb-4">
                                                    ${["Recv", "Prep", "Way", "Done"].map((s, idx) => `
                                                        <button onclick="updateStatus('${o.cloudId}', ${o.status}, ${idx})" class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${o.status === idx ? 'bg-royal-blue text-white shadow-md' : 'bg-silver-mist text-royal-blue border border-silver-plate hover:bg-white'}">${s}</button>
                                                    `).join('')}
                                                </div>
                                                
                                                <div class="flex justify-between items-center">
                                                    <div><p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Total</p><p class="text-2xl font-black text-royal-blue">â‚¹${o.total}</p></div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            ${window.state.editingOrder ? `
                                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-royal-blue/30 backdrop-blur-sm animate-slide-up">
                                    <div class="bg-white w-full max-w-lg rounded-[2rem] p-8 shadow-2xl border border-white/20">
                                        <h3 class="text-2xl font-black text-royal-blue mb-6">Edit Order</h3>
                                        
                                        <div class="space-y-4 max-h-[60vh] overflow-y-auto custom-scrollbar pr-2">
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">Room</label>
                                                    <input id="edit-room" type="text" value="${window.state.editingOrder.room}" class="w-full p-4 bg-silver-mist border border-silver-plate rounded-xl font-bold text-royal-blue focus:border-royal-blue outline-none">
                                                </div>
                                                <div>
                                                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">Phone</label>
                                                    <input id="edit-phone" type="text" value="${window.state.editingOrder.phone}" class="w-full p-4 bg-silver-mist border border-silver-plate rounded-xl font-bold text-royal-blue focus:border-royal-blue outline-none">
                                                </div>
                                            </div>
                                            
                                            <div class="border-t border-dashed border-silver-plate pt-4">
                                                <label class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1 mb-2 block">Order Items & Prices</label>
                                                <div class="space-y-3 mb-4">
                                                    ${window.state.editingOrder.items.map((i, idx) => `
                                                        <div class="flex items-center gap-2 bg-silver-mist p-3 rounded-xl border border-silver-plate edit-item-row" data-qty="${i.qty}" data-uid="${i.uid || ''}">
                                                            <div class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-gray-200 rounded-full text-xs font-black text-gray-600">${i.qty}x</div>
                                                            <input type="text" class="flex-1 p-2 rounded-lg border border-gray-200 text-sm font-bold text-royal-blue edit-item-name" value="${i.name}">
                                                            <div class="relative w-24">
                                                                <span class="absolute left-2 top-2 text-gray-400 font-bold text-sm">â‚¹</span>
                                                                <input type="number" class="w-full p-2 pl-6 rounded-lg border border-gray-200 text-sm font-bold text-garden-green-dark edit-item-price" value="${i.price}">
                                                            </div>
                                                            <button onclick="removeItemFromEdit(${idx})" class="text-red-400 hover:text-red-600 p-2"><i data-lucide="trash" class="w-4 h-4"></i></button>
                                                        </div>
                                                    `).join('')}
                                                </div>
                                            </div>

                                            <div>
                                                <label class="text-xs font-bold text-gray-400 uppercase tracking-widest ml-1">Total Amount (â‚¹)</label>
                                                <input id="edit-total" type="number" value="${window.state.editingOrder.total}" class="w-full p-4 bg-silver-mist border border-silver-plate rounded-xl font-bold text-royal-blue focus:border-royal-blue outline-none">
                                            </div>
                                        </div>

                                        <div class="flex gap-3 mt-8">
                                            <button onclick="setState({editingOrder: null})" class="flex-1 p-4 rounded-xl font-bold text-gray-400 hover:bg-gray-50 transition-colors">Cancel</button>
                                            <button onclick="saveOrderEdit('${window.state.editingOrder.cloudId}')" class="flex-1 primary-button p-4 rounded-xl font-black shadow-lg">Save Changes</button>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            ${window.state.viewImage ? `
                                <div class="fixed inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center p-4 animate-slide-up">
                                    <button onclick="setState({viewImage: null})" class="absolute top-6 right-6 bg-white/10 text-white hover:bg-white hover:text-black p-3 rounded-full transition-all backdrop-blur-md">
                                        <i data-lucide="x" class="w-8 h-8"></i>
                                    </button>
                                    <img src="${window.state.viewImage}" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
                                </div>
                            ` : ''}
                        `}
                    </div>
                `;
            }
            lucide.createIcons();
        }

        initApp();
    </script>
</body>
</html>
